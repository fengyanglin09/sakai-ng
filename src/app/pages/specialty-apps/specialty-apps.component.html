<div class="card">
    <p-table #table [value]="specialtyApps"

             dataKey="appCategory.id"
             rowGroupMode="subheader"
             groupRowsBy="appCategory.id"
             [expandedRowKeys]="expandedRowGroupKeys"
             [tableStyle]="{'min-width': '70rem'}">
        <ng-template #header>
            <tr>
                <th style="width:13%">AppName</th>
                <th style="width:9%">Config Item</th>
                <th style="width:10%">App Info</th>
                <th style="width:14%">Dev Env</th>
                <th style="width:14%">Int/Test Env</th>
                <th style="width:14%">Stg Env</th>
                <th style="width:14%">Prod Env</th>
                <th style="width:5%">App Spec</th>
                <th style="width:8%">Updated On</th>
            </tr>
        </ng-template>
        <ng-template #groupheader let-app let-rowIndex="rowIndex" let-expanded="expanded">
            <tr>
                <td colspan="5">
                    <button
                        type="button"
                        pButton
                        pRipple
                        [pRowToggler]="app"
                        text
                        rounded
                        plain
                        class="mr-2"
                        [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'">
                    </button>
                    <img
                        [alt]="getAppHeaderInfo(app.appCategory.id, 'name')"
                        [src]="getAppHeaderInfo(app.appCategory.id, 'image')"
                        width="32"
                        style="vertical-align: middle; display: inline-block" />
                    <span class="font-bold ml-2">{{getAppHeaderInfo(app.appCategory.id, 'name')}}</span>

                    <ng-container *ngFor="let item of getAppHeaderInfo(app.appCategory.id, 'backlogUrl')">
                        <!-- template content -->
                        <a href="{{item.url}}" target="_blank" class="ml-3">
                            <i pTooltip="{{item.label}}" tooltipPosition="top"  [class]="AppItemIcon['appBackLogLink']"
                               style="font-size: 1.2em; color: green;"
                            ></i>
                        </a>
                    </ng-container>

                </td>
            </tr>
        </ng-template>
        <ng-template #groupfooter let-app>
            <tr class="p-rowgroup-footer">
                <td colspan="8" style="text-align: right">Total App Count:</td>
                <td> <p-tag [value]="'' + calculateAppTotal(app.appCategory.name)"> </p-tag></td>
            </tr>
        </ng-template>
        <ng-template #expandedrow let-app>
            <tr>
                <td>
                    <span style="font-family: 'Courier New', Courier, monospace; font-weight: bold; font-size: large" >{{app.name}}</span>
                </td>
                <td>
                    <span style="font-family: 'Courier New', Courier, monospace; font-weight: bold; font-size: medium" >{{app.configurationItem}}</span>
                </td>
                <td>
                    <span style="display: flex; gap: 6px; align-items: center;">
                        <a href="{{app.wikiLink}}" target="_blank">
                            <i pTooltip="wiki" tooltipPosition="top"  [class]="AppItemIcon['wikiLink']"
                               style="font-size: 1.2em;"
                               [ngStyle]="{'color': app.wikiLink ? 'green' : 'gray'}"
                            ></i>
                        </a>
                        <a href="{{app.orgLink}}" target="_blank">
                            <i pTooltip="org page" tooltipPosition="top"  [class]="AppItemIcon['orgLink']"
                               style="font-size: 1.2em;"
                               [ngStyle]="{'color': app.orgLink ? 'green' : 'gray'}"
                            ></i>
                        </a>
                    </span>
                </td>

                <td *ngFor="let env of app.environments">
                    <span style="display: flex; gap: 6px; align-items: center;">
                        <a href="{{env.appWebUri}}" target="_blank">
                            <i pTooltip="url" tooltipPosition="top" [class]="AppItemIcon['appUri']"
                               style="font-size: 1.2em;"
                               [ngStyle]="{'color': env.appWebUri ? 'green' : 'gray'}"
                            ></i>
                        </a>
                        <a href="{{env.appSwaggerUri}}" target="_blank">
                            <i pTooltip="swagger" tooltipPosition="top"  [class]="AppItemIcon['swaggerUri']"
                               style="font-size: 1.2em;"
                               [ngStyle]="{'color': env.appSwaggerUri ? 'green' : 'gray'}"
                            ></i>
                        </a>

                        <i pTooltip="apigee" tooltipPosition="top"  [class]="AppItemIcon['apigeeUri']"
                           (click)="displayPopover('Apigee Base Url', env.apigeeUri, op, $event)"
                           style="font-size: 1.2em; cursor: pointer"
                           [ngStyle]="{'color': env.apigeeUri ? 'green' : 'gray'}"
                        ></i>


                        <i pTooltip="db url" tooltipPosition="top"  [class]="AppItemIcon['dbConnectionString']"
                           (click)="displayPopover('DataBase Url', env.appDbConnectionString, op, $event)"
                           style="font-size: 1.2em;"
                           [ngStyle]="{'color': env.appDbConnectionString ? 'green' : 'gray'}"
                        ></i>


                        <i pTooltip="azure client id" tooltipPosition="top"  [class]="AppItemIcon['azureId']"
                           (click)="displayPopover('Azure Client Id', env.appAzureId, op, $event)"
                           style="font-size: 1.2em;"
                           [ngStyle]="{'color': env.appAzureId ? 'green' : 'gray'}"
                        ></i>

                    </span>
                </td>


                <td>
                    <a href="{{app.appSpecificationLink}}" target="_blank">
                        <i [class]="AppItemIcon['appSpecificationLink']"
                           style="font-size: 1.2em;"
                           [ngStyle]="{'color': app.appSpecificationLink ? 'green' : 'gray'}"
                        ></i>
                    </a>
                </td>

                <td>
                    <span style="font-family: 'Courier New', Courier, monospace; font-weight: bold" > {{app.updatedOn | date:'MM/dd/yyyy'}} </span>
                </td>

            </tr>
        </ng-template>
    </p-table>
</div>




<p-popover #op (onHide)="popoverText = undefined">

    <ng-template #content>
        <ng-container *ngIf="popoverText">

            <div>
                <span class="font-medium text-surface-900 dark:text-surface-0 block mb-2">{{popoverText.title ?? ''}}</span>
                <p-inputgroup>
                    <input pInputText [value]="popoverText.content" readonly class="w-[25rem]" />
                    <p-inputgroup-addon
                    [ngStyle]="{'cursor': 'pointer'}"
                    (click)="copyToClipboard(popoverText.content ?? '')"
                    >
                        <i class="pi pi-copy"></i>
                    </p-inputgroup-addon>
                </p-inputgroup>
            </div>

        </ng-container>
    </ng-template>

</p-popover>
